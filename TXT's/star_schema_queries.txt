STAR SCHEMA OPTIMIZED QUERIES
========================================

QUERY 1: Monthly Encounters By Specialty
SELECT 
    d.month_year,
    s.specialty_name,
    et.encounter_type_name,
    COUNT(*) AS total_encounters,
    COUNT(DISTINCT f.patient_key) AS unique_patients
FROM fact_encounters f
JOIN dim_date d ON f.date_key = d.date_key
JOIN dim_specialty s ON f.specialty_key = s.specialty_key
JOIN dim_encounter_type et ON f.encounter_type_key = et.encounter_type_key
GROUP BY 
    d.month_year,
    s.specialty_name,
    et.encounter_type_name
ORDER BY d.month_year, s.specialty_name, et.encounter_type_name
LIMIT 10;

Execution Time
* ~115 ms vs. ~39 ms (OLTP)

Improvement Factor
* 0.3× (Star slower at this scale)

Explanation
* Dataset is small; OLTP indexes are already efficient
* Additional dimension joins introduce overhead
* Star schema advantage not visible at low volume


QUERY 2: Top Diagnosis-Procedure Pairs
SELECT 
    diag.icd10_code,
    proc.cpt_code,
    COUNT(DISTINCT f.encounter_key) AS encounter_count
FROM fact_encounters f
JOIN bridge_encounter_diagnoses bd ON f.encounter_key = bd.encounter_key
JOIN bridge_encounter_procedures bp ON f.encounter_key = bp.encounter_key
JOIN dim_diagnosis diag ON bd.diagnosis_key = diag.diagnosis_key
JOIN dim_procedure proc ON bp.procedure_key = proc.procedure_key
GROUP BY diag.icd10_code, proc.cpt_code
ORDER BY encounter_count DESC
LIMIT 20;

Execution Time
* ~35 ms vs. ~39 ms (OLTP)

Improvement Factor
* 1.1× faster

Explanation
* Integer surrogate keys speed up joins
* Bridge tables simplify many-to-many relationships
* Reduced natural-key comparisons


QUERY 3: 30-Day Readmission Rate
SELECT 
    s.specialty_name,
    COUNT(DISTINCT e1.encounter_key) AS total_discharges,
    COUNT(DISTINCT e2.encounter_key) AS readmissions
FROM fact_encounters e1
JOIN dim_specialty s ON e1.specialty_key = s.specialty_key
LEFT JOIN fact_encounters e2
  ON e1.patient_key = e2.patient_key
 AND e2.encounter_date BETWEEN e1.discharge_date
                           AND DATE_ADD(e1.discharge_date, INTERVAL 30 DAY)
WHERE e1.discharge_date IS NOT NULL
GROUP BY s.specialty_name;

Execution Time
* ~61 ms vs. ~48 ms (OLTP)

Improvement Factor
* 0.8× (Star slower at this scale)

Explanation
* Self-join dominates query cost
* Star schema benefits appear only at large fact sizes
* Dimension joins add overhead with small datasets


QUERY 4: Revenue by Specialty and Month
SELECT 
    d.month_year,
    s.specialty_name,
    SUM(f.total_allowed_amount) AS total_revenue
FROM fact_encounters f
JOIN dim_date d ON f.date_key = d.date_key
JOIN dim_specialty s ON f.specialty_key = s.specialty_key
GROUP BY d.month_year, s.specialty_name;


Execution Time
* ~32 ms vs. ~17 ms (OLTP)

Improvement Factor
* 0.5× (Star slower at this scale)

Explanation
* Aggregation cost is low with limited rows
* OLTP billing joins already well indexed
* Star schema benefits emerge with large fact tables